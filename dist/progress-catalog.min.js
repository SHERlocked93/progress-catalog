"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};exports.default=function(t){var e={linkClass:"cl-link",linkActiveClass:"cl-link-active",datasetName:"data-cata-target",selector:["h1","h2","h3","h4","h5","h6"],scrollWrapper:null,activeHook:null,topMargin:0,bottomMargin:0,cool:true};var d=Object.assign({},e,t);var r=document.getElementById(d.contentEl);var a=d.scrollWrapper||r.parentNode||document.body;var o=document.getElementById(d.catalogEl);var n=r.querySelectorAll(d.selector.join());var i=m(n);try{o.innerHTML="<div class='cl-wrapper'>"+y(i,{id:-1})+'<svg class="cl-marker" width="200" height="200" xmlns="http://www.w3.org/2000/svg">\n            <path stroke="#42B983" stroke-width="3" fill="transparent" stroke-dasharray="0, 0, 0, 1000" stroke-linecap="round" stroke-linejoin="round" transform="translate(-0.5, -0.5)" />\n            </svg></div>'}catch(t){console.error("error in progress-catalog",t)}var f=o.querySelector(".cl-marker path");var v=void 0,p=void 0;window.addEventListener("resize",l);o.addEventListener("click",u);d.cool&&a.addEventListener("scroll",s);d.cool||a.addEventListener("scroll",c);setTimeout(l);function l(){v=[].concat(_toConsumableArray(o.querySelectorAll("li")));v=v.map(function(t){var e=t.querySelector("."+d.linkClass);var r=document.getElementById(e.getAttribute("data-cata-target"));return{listItem:t,anchor:e,target:r}});v=v.filter(function(t){return!!t.target});var c=[];var u=void 0;v.forEach(function(t,e){var r=t.anchor,a=r.offsetLeft,o=r.offsetTop,n=r.offsetHeight,i=d.cool?a-5:a,l=o,s=n;if(e===0){c.push("M",i,l,"L",i,l+s);t.pathStart=0}else{if(u!==i)c.push("L",u,l);c.push("L",i,l);f.setAttribute("d",c.join(" "));t.pathStart=f.getTotalLength()||0;c.push("L",i,l+s)}u=i;f.setAttribute("d",c.join(" "));t.pathEnd=f.getTotalLength()});p=f.getTotalLength();s()}function s(){var n=a.clientHeight;var i=p,l=0,s=0;v.forEach(function(t){var e=t.target.getBoundingClientRect(),r=e.bottom,a=e.top,o=t.listItem.firstChild;if(r>d.topMargin&&a<n-d.bottomMargin){i=Math.min(t.pathStart,i);l=Math.max(t.pathEnd,l);s+=1;o.classList.add(d.linkActiveClass);d.cool&&o.classList.add("cl-transform")}else{o.classList.remove(d.linkActiveClass);d.cool&&o.classList.remove("cl-transform")}});if(s>0&&i<l&&d.cool){f.setAttribute("stroke-dashoffset","1");f.setAttribute("stroke-dasharray","1, "+i+", "+(l-i)+", "+p);f.setAttribute("opacity","1")}else{f.setAttribute("opacity","0")}}function c(t){var e=null;for(var r=n.length-1;r>=0;r--){if(n[r].offsetTop<=a.scrollTop){e=n[r];break}}if(e)k(e.id);else k(null)}function u(t){var e=t.target;var r=e.getAttribute(d.datasetName);e.classList.contains(d.linkClass)&&document.getElementById(r).scrollIntoView({behavior:"smooth",block:"start"})}function m(t){var e=void 0,r=void 0,a=[],o={},n={id:-1},i=null,l=void 0;for(var s=0;s<t.length;s++){e=t[s].innerText||t[s].textContent;r=t[s].tagName;l="heading-"+s;t[s].id=l;o={name:e,tagName:r,id:l,level:+g(r),parent:n};if(i){if(g(o.tagName)>g(i.tagName)){o.parent=i}else{o.parent=h(o,i)}}i=o;a.push(o)}return a}function h(t,e){var r=e.parent;while(r&&g(t.tagName)<=g(r.tagName)){r=r.parent}return r||{id:-1}}function g(t){return t?t.slice(1):0}function y(t,e){var r=void 0,a=false;if(t){r="<ul>";for(var o=0;o<t.length;o++){if(b(t[o].parent,e)){a=true;r+="<li><div class='"+d.linkClass+" cl-level-"+t[o].level+"' "+d.datasetName+"='"+t[o].id+"'>"+t[o].name+"</div>";r+=y(t,t[o]);r+="</li>"}}r+="</ul>"}return a?r:""}function b(t,e){return t&&e&&(typeof t==="undefined"?"undefined":_typeof(t))==="object"&&(typeof e==="undefined"?"undefined":_typeof(e))==="object"&&t.id===e.id}function k(e){var r=this;var t=[].concat(_toConsumableArray(o.querySelectorAll("["+d.datasetName+"]")));t.forEach(function(t){if(t.getAttribute(d.datasetName)===e){typeof d.activeHook==="function"&&!t.classList.contains(d.linkActiveClass)&&d.activeHook.call(r,t);t.classList.add(d.linkActiveClass)}else{t.classList.remove(d.linkActiveClass)}})}};function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++){r[e]=t[e]}return r}else{return Array.from(t)}}